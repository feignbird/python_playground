<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Python Playground | Attentionverse</title>

<!-- <link rel="stylesheet" href="https://brython.info/brython.css"> -->
<link rel="stylesheet" href="https://www.brython.info/tests/console.css">

<script type="text/javascript" src="https://brython.info/src/brython_builtins.js"></script>
<script type="text/javascript" src="https://brython.info/src/builtins_docstrings.js"></script>
<script type="text/javascript" src="https://brython.info/src/version_info.js"></script>
<script type="text/javascript" src="https://brython.info/src/python_tokenizer.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_ast.js"></script>
<script type="text/javascript" src="https://brython.info/src/py2js.js"></script>
<script type="text/javascript" src="https://brython.info/src/loaders.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_object.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_type.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_utils.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_sort.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_builtin_functions.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_exceptions.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_range_slice.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_bytes.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_set.js"></script>
<script type="text/javascript" src="https://brython.info/src/js_objects.js"></script>
<script type="text/javascript" src="https://brython.info/src/stdlib_paths.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_import.js"></script>
<script type="text/javascript" src="https://brython.info/src/unicode_data.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_string.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_int.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_long_int.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_float.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_complex.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_dict.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_list.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_generator.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_dom.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_pattern_matching.js"></script>
<script type="text/javascript" src="https://brython.info/src/builtin_modules.js"></script>
<script type="text/javascript" src="https://brython.info/src/async.js"></script>
<script type="text/javascript" src="https://brython.info/src/ast_to_js.js"></script>
<script type="text/javascript" src="https://brython.info/src/symtable.js"></script>

<script type="text/javascript" src="https://brython.info/src/brython_stdlib.js"></script>

<script src="https://brython.info/assets/header.brython.js"></script>
<!--    #1.4.13 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.7.1/ace.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.7.1/ext-language_tools.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.7.1/theme-solarized_light.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.7.1/mode-python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.7.1/keybinding-vscode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.7.1/ext-searchbox.min.js"></script>

<script type="text/python3" id="tests_editor">
from browser import document as doc, window
from browser import html

import sys
import time
import binascii
import ast
import json

import tb as traceback
import javascript


from browser import console, document, window, alert, bind, html
import browser.widgets.dialog as dialog


console.log(window.navigator.userAgent)
def get_device_type():
    ua = window.navigator.userAgent
    if "android" in ua.lower():
        return "android"
    elif "iphone" in ua.lower():
        return "iphone"
    elif "ipad" in ua.lower():
        return "ipad"
    else:
        return "computer"


def make_structure_for_desktop_computers():
    table_ele = html.TABLE(id = "container")
    
    # first row
    tr_menu_buttons = html.TR()
    button_group_cell = html.TD()
    empty_cells = (html.TD() for x in range(2))
    
    run_button = html.BUTTON(" ▶ Run", id = "run")
    show_console_button = html.BUTTON("Python", id = "show_console")
    show_js_button = html.BUTTON("Javascript", id = "show_js")
    share_code_button = html.BUTTON('Share code', id = "share_code", onclick="copyUrl()")
    
    button_group_cell <= run_button
    button_group_cell <= show_console_button
    button_group_cell <= show_js_button
    button_group_cell <= share_code_button

    tr_menu_buttons <= button_group_cell
    tr_menu_buttons <= empty_cells

    
    # second row
    tr_editor_area = html.TR()
    editor_cell = html.TD((html.DIV(id = 'editor', style={"width":"100%"})), id = "left")
    separator_cell = html.TD(id = 'separator')
    console_cell = html.TD((html.TEXTAREA(id="console", style={'background-color':"black", 'color':'azure'}, autocomplete="off")), id = "right")

    tr_editor_area <= editor_cell
    tr_editor_area <= separator_cell
    tr_editor_area <= console_cell


    table_ele <= tr_menu_buttons
    table_ele <= tr_editor_area

    return table_ele



def make_structure_for_mobile_computers():
    table_ele = html.TABLE(id = "container", style={'width':"100%"})
        
    # first row
    tr_menu_buttons = html.TR()
    button_group_cell = html.TD()
    empty_cells = (html.TD() for x in range(2))

    run_button = html.BUTTON(" ▶ Run", id = "run", style={'font-size':"40px"})
    show_console_button = html.BUTTON("Python", id = "show_console", style = {'font-size': "40px"})
    show_js_button = html.BUTTON("Javascript", id = "show_js", style = {'font-size': "40px"})
    share_code_button = html.BUTTON('Share code', id = "share_code", onclick="copyUrl()", style = {'font-size': "40px"})

    button_group_cell <= run_button
    button_group_cell <= show_console_button
    button_group_cell <= show_js_button
    button_group_cell <= share_code_button

    tr_menu_buttons <= button_group_cell
    tr_menu_buttons <= empty_cells


    # second row
    editor_row = html.TR(html.TD((html.DIV(id = 'editor', style={'width':"100%", 'font-size':"40px"})), id='left', style = {'height':"49%"}, colspan = "3"))
    
    # third row
    separator_row = html.TR(html.TD(id='separator', style={'height':"1%"}, colspan = "3"))

    # fourth row
    textarea_row = html.TR(html.TD(html.TEXTAREA(id='console', style={'background-color':'black', 'color':'azure'}, autocomplete='off'), id='right', colspan = "3"))

    table_ele <= tr_menu_buttons
    table_ele <= editor_row
    table_ele <= separator_row
    table_ele <= textarea_row
    return table_ele



if get_device_type() in ['android', 'iphone']:
    document.body <= make_structure_for_mobile_computers()
    console.log("removed for mobile")
else:
    document.body <= make_structure_for_desktop_computers()
    console.log("removed for computer")



# set height of container to 75% of screen
_height = document.documentElement.clientHeight
_s = document['container']
_s.style.height = '%spx' % int(_height * 0.85)





has_ace = True
try:
    editor = window.ace.edit("editor")
    editor.setTheme("ace/theme/solarized_light")
    editor.session.setMode("ace/mode/python")
    try:
        editor.setKeyboardHandler("ace/keyboard/vscode")
    except:
        print("error")
    editor.focus()

    editor.setOptions({
     'enableLiveAutocompletion': True,
     'highlightActiveLine': False,
     'highlightSelectedWord': True
    })
except:
    from browser import html
    editor = html.TEXTAREA(rows=20, cols=70)
    document["editor"] <= editor
    def get_value(): return editor.value
    def set_value(x): editor.value = x
    editor.getValue = get_value
    editor.setValue = set_value
    has_ace = False

if hasattr(window, 'localStorage'):
    from browser.local_storage import storage
else:
    storage = None


current_code = "for x in range(10):\n\tprint(x)"

def reset():
    global current_code
    initial_url_state = window.location.href 
    if "?code" in document.query:
        code = document.query.getlist("code")[0]
        editor.setValue(code)
    elif "#" in initial_url_state:
        url_encoded_data_str = initial_url_state.split("#")[1]
        console.log("url_encoded_data_str", url_encoded_data_str)
        url_encoded_data_str = url_encoded_data_str.strip().strip("data=")
        console.log("url_encoded_data_str 2", url_encoded_data_str)
        data_str = window.decodeURIComponent(url_encoded_data_str.replace("+", " "))
        console.log("data_str", data_str)
        code_dict = dict(ast.literal_eval(data_str))
        console.log(code_dict)
        current_code = code_dict['code']
        editor.setValue(current_code)
    else:
        editor.setValue(current_code)


class cOutput:
    encoding = 'utf-8'

    def __init__(self):
        self.cons = document["console"]
        self.buf = ''

    def write(self, data):
        self.buf += str(data)

    def flush(self):
        self.cons.value += self.buf
        self.buf = ''

    def __len__(self):
        return len(self.buf)

if "console" in document:
    cOut = cOutput()
    sys.stdout = cOut
    sys.stderr = cOut


output = ''


def show_console(ev):
    document["console"].value = output
    document["console"].cols = 60


# run a script, in global namespace if in_globals is True
def run(*args):
    global output
    document["console"].value = ''
    src = editor.getValue()

    t0 = time.perf_counter()
    try:
        ns = {'__name__':'__main__'}
        exec(src, ns)
        state = 1
    except Exception as exc:
        traceback.print_exc(file=sys.stderr)
        state = 0
    sys.stdout.flush()
    output = document["console"].value

    print('<completed in %6.2f ms>' % ((time.perf_counter() - t0) * 1000.0))
    return state


@bind(editor, 'input')
def url_code_appender(e):
    location_obj = document.location
    code_dict = {"code" : editor.getValue()}
    location_obj.hash = "data=" + window.encodeURIComponent(json.dumps(code_dict)).replace("'", "%27").replace("\"", "%22")


def show_js(ev):
    src = editor.getValue()
    document["console"].value = javascript.py2js(src, '__main__')




# next functions are defined in editor.py
doc['show_js'].bind('click', show_js)

# Create a lambda around editor.run() so that the event object is not passed to it
doc['run'].bind('click',lambda *args: run())
doc['show_console'].bind('click', show_console)

reset()

</script>

<script>
function run_js(){
    var cons = document.getElementById("console")
    var jscode = cons.value
    var t0 = (new Date()).getTime()
    eval(jscode)
    var t1 = (new Date()).getTime()
    console.log("Javascript code run in "+(t1-t0)+" ms")
}

function copyUrl(){
    var text = window.location.href;
    var elem = document.createElement("textarea");
    document.body.appendChild(elem);
    elem.value = text;
    elem.select();
    document.execCommand("copy");
    document.body.removeChild(elem);
    document.getElementById('share_code').innerHTML = "Link copied";
    setTimeout(makeShareCodeOriginal, 3000)
}
function makeShareCodeOriginal(){
    document.getElementById("share_code").innerHTML = "Share code";
}

</script>
<style>
    body{
        background-color:darkgray;
    }

    #show_console,
    #show_js,
    #share_code,
    #run {
        display: inline-block;
        padding: 10px 18px;
        font-size: 18px;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        outline: none;
        color: #fff;
        background-color: #000000;
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px #999;
    }

    #show_console:active,
    #show_js:active,
    #share_code:active,
    #run:active{
        background-color: #3e8e41;
        box-shadow: 0 2px #666;
        transform: translateY(2px);
    }

    #show_console:hover,
    #show_js:hover,
    #share_code:hover,
    #run:hover{background-color: #3e8e41}

</style>
</head>
<body onload="brython()"></body>
</html>
