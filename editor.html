<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Python Playground | Attentionverse</title>

<!-- <link rel="stylesheet" href="https://brython.info/brython.css"> -->
<link rel="stylesheet" href="https://www.brython.info/tests/console.css">

<script type="text/javascript" src="https://brython.info/src/brython_builtins.js"></script>
<script type="text/javascript" src="https://brython.info/src/version_info.js"></script>
<script type="text/javascript" src="https://brython.info/src/python_tokenizer.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_ast.js"></script>
<script type="text/javascript" src="https://brython.info/src/py2js.js"></script>
<script type="text/javascript" src="https://brython.info/src/loaders.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_object.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_type.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_utils.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_sort.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_builtin_functions.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_exceptions.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_range_slice.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_bytes.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_set.js"></script>
<script type="text/javascript" src="https://brython.info/src/js_objects.js"></script>
<script type="text/javascript" src="https://brython.info/src/stdlib_paths.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_import.js"></script>
<script type="text/javascript" src="https://brython.info/src/unicode_data.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_string.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_int.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_long_int.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_float.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_complex.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_dict.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_list.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_generator.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_dom.js"></script>
<script type="text/javascript" src="https://brython.info/src/py_pattern_matching.js"></script>
<script type="text/javascript" src="https://brython.info/src/builtin_modules.js"></script>
<script type="text/javascript" src="https://brython.info/src/async.js"></script>
<script type="text/javascript" src="https://brython.info/src/ast_to_js.js"></script>
<script type="text/javascript" src="https://brython.info/src/symtable.js"></script>

<script type="text/javascript" src="https://brython.info/src/brython_stdlib.js"></script>

<script src="https://brython.info/assets/header.brython.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.13/ace.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.13/ext-language_tools.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.13/theme-solarized_light.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.13/mode-python.min.js"></script>


<script type="text/python3" id="tests_editor">
from browser import document as doc, window
from browser import html

import sys
import time
import binascii
import ast
import json

import tb as traceback
import javascript

from browser import console, document, window, alert, bind, html
import browser.widgets.dialog as dialog

# set height of container to 75% of screen
_height = document.documentElement.clientHeight
_s = document['container']
_s.style.height = '%spx' % int(_height * 0.85)

has_ace = True
try:
    editor = window.ace.edit("editor")
    editor.setTheme("ace/theme/solarized_light")
    editor.session.setMode("ace/mode/python")
    editor.focus()

    editor.setOptions({
     'enableLiveAutocompletion': True,
     'highlightActiveLine': False,
     'highlightSelectedWord': True
    })
except:
    from browser import html
    editor = html.TEXTAREA(rows=20, cols=70)
    document["editor"] <= editor
    def get_value(): return editor.value
    def set_value(x): editor.value = x
    editor.getValue = get_value
    editor.setValue = set_value
    has_ace = False

if hasattr(window, 'localStorage'):
    from browser.local_storage import storage
else:
    storage = None


current_code = "for x in range(10):\n\tprint(x)"

def reset():
    global current_code
    initial_url_state = window.location.href 
    if "?code" in document.query:
        code = document.query.getlist("code")[0]
        editor.setValue(code)
    elif "#" in initial_url_state:
        url_encoded_data_str = initial_url_state.split("#")[1]
        console.log("url_encoded_data_str", url_encoded_data_str)
        url_encoded_data_str = url_encoded_data_str.strip().strip("data=")
        console.log("url_encoded_data_str 2", url_encoded_data_str)
        data_str = window.decodeURIComponent(url_encoded_data_str.replace("+", " "))
        console.log("data_str", data_str)
        code_dict = dict(ast.literal_eval(data_str))
        console.log(code_dict)
        current_code = code_dict['code']
        editor.setValue(current_code)
    else:
        editor.setValue(current_code)


class cOutput:
    encoding = 'utf-8'

    def __init__(self):
        self.cons = document["console"]
        self.buf = ''

    def write(self, data):
        self.buf += str(data)

    def flush(self):
        self.cons.value += self.buf
        self.buf = ''

    def __len__(self):
        return len(self.buf)

if "console" in document:
    cOut = cOutput()
    sys.stdout = cOut
    sys.stderr = cOut


output = ''


def show_console(ev):
    document["console"].value = output
    document["console"].cols = 60


# run a script, in global namespace if in_globals is True
def run(*args):
    global output
    document["console"].value = ''
    src = editor.getValue()

    t0 = time.perf_counter()
    try:
        ns = {'__name__':'__main__'}
        exec(src, ns)
        state = 1
    except Exception as exc:
        traceback.print_exc(file=sys.stderr)
        state = 0
    sys.stdout.flush()
    output = document["console"].value

    print('<completed in %6.2f ms>' % ((time.perf_counter() - t0) * 1000.0))
    return state


@bind(editor, 'input')
def url_code_appender(e):
    location_obj = document.location
    code_dict = {"code" : editor.getValue()}
    location_obj.hash = "data=" + window.encodeURIComponent(json.dumps(code_dict)).replace("'", "%27").replace("\"", "%22")


def show_js(ev):
    src = editor.getValue()
    document["console"].value = javascript.py2js(src, '__main__')



def share_code(ev):
    src = editor.getValue()
    if len(src) > 2048:
        d = dialog.InfoDialog("Copy url",
                              f"code length is {len(src)}, must be < 2048",
                              style={"zIndex": 10},
                              ok=True)
    else:
        href = window.location.href.rsplit("?", 1)[0]
        query = document.query
        query["code"] = src
        url = f"{href}{query}"
        url = url.replace("(", "%28").replace(")", "%29")
        d = dialog.Dialog("Copy url")
        area = html.TEXTAREA(rows=0, cols=0)
        d.panel <= area
        area.value = url
        # copy to clipboard
        area.focus()
        area.select()
        document.execCommand("copy")
        d.remove()
        d = dialog.Dialog("Copy url")
        d.panel <= html.DIV("url copied in the clipboard<br>Send it to share the code")
        buttons = html.DIV()
        ok = html.BUTTON("Ok")
        buttons <= html.DIV(ok, style={"text-align": "center"})
        d.panel <= html.BR() + buttons

        @bind(ok, "click")
        def click(evt):
            d.remove()


# next functions are defined in editor.py
doc['show_js'].bind('click', show_js)
doc['share_code'].bind('click', share_code)

# Create a lambda around editor.run() so that the event object is not passed to it
doc['run'].bind('click',lambda *args: run())
doc['show_console'].bind('click', show_console)

reset()

</script>

<script>
function run_js(){
    var cons = document.getElementById("console")
    var jscode = cons.value
    var t0 = (new Date()).getTime()
    eval(jscode)
    var t1 = (new Date()).getTime()
    console.log("Javascript code run in "+(t1-t0)+" ms")
}
</script>
<style>
  body{
    background-color:darkgray;
  }
  #show_console,
  #show_js,
  #share_code,
  #run {
    display: inline-block;
    padding: 10px 18px;
    font-size: 18px;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    outline: none;
    color: #fff;
    background-color: #000000;
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px #999;
}

#show_console:active,
#show_js:active,
#share_code:active,
#run:active{
    background-color: #3e8e41;
    box-shadow: 0 2px #666;
    transform: translateY(2px);
}

#show_console:hover,
#show_js:hover,
#share_code:hover,
#run:hover{background-color: #3e8e41}
</style>
</head>
<body onload="brython()">

<table id="container">
  <tr>

    <td>
        <button id="run"> â–¶ Run</button>
        <button id="show_console">Python</button>
        <button id="show_js">Javascript</button>
        <button id="share_code">Share code</button>
    </td>
    <td></td>
    <td></td>
  </tr>

  <tr>
    <td id="left">
      <div id="editor" style="width:100%;"></div>
    </td>
    <td id="separator"></td>
    <td id="right">
      <textarea id="console" style="background-color:black;color:azure;" autocomplete="off"></textarea>
    </td>
  </tr>
</table>

</body>
</html>
